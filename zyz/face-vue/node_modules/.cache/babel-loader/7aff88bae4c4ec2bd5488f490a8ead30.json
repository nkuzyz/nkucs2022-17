{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"camera-box\",\n  style: {\n    \"width\": \"900px\"\n  }\n};\n\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"div\", {\n  style: {\n    \"text-align\": \"center\",\n    \"font-size\": \"14px\",\n    \"font-weight\": \"bold\",\n    \"margin-bottom\": \"10px\"\n  }\n}, \" 摄像头 \", -1\n/* HOISTED */\n);\n\nconst _hoisted_3 = /*#__PURE__*/_createElementVNode(\"video\", {\n  id: \"video\",\n  width: \"400\",\n  height: \"300\"\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_4 = {\n  class: \"iCenter\"\n};\n\nconst _hoisted_5 = /*#__PURE__*/_createTextVNode(\"拍照\");\n\nconst _hoisted_6 = /*#__PURE__*/_createElementVNode(\"div\", {\n  style: {\n    \"text-align\": \"center\",\n    \"font-size\": \"14px\",\n    \"font-weight\": \"bold\",\n    \"margin-bottom\": \"10px\"\n  }\n}, \" 拍摄效果 \", -1\n/* HOISTED */\n);\n\nconst _hoisted_7 = /*#__PURE__*/_createElementVNode(\"canvas\", {\n  id: \"canvas\",\n  width: \"400\",\n  height: \"300\",\n  style: {\n    \"display\": \"block\"\n  }\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_8 = /*#__PURE__*/_createTextVNode(\"保存\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n\n  const _component_el_col = _resolveComponent(\"el-col\");\n\n  const _component_el_row = _resolveComponent(\"el-row\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_row, {\n    gutter: 20\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_col, {\n      span: 12\n    }, {\n      default: _withCtx(() => [_hoisted_2, _createCommentVNode(\" 这里就是摄像头显示的画面 \"), _hoisted_3, _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n        type: \"primary\",\n        size: \"small\",\n        icon: \"el-icon-camera\",\n        onClick: $options.takePhone,\n        style: {\n          \"margin-top\": \"10px\"\n        }\n      }, {\n        default: _withCtx(() => [_hoisted_5]),\n        _: 1\n        /* STABLE */\n\n      }, 8\n      /* PROPS */\n      , [\"onClick\"])])]),\n      _: 1\n      /* STABLE */\n\n    }), _createVNode(_component_el_col, {\n      span: 12\n    }, {\n      default: _withCtx(() => [_hoisted_6, _createCommentVNode(\" 这里是点击拍照显示的图片画面 \"), _hoisted_7, _createVNode(_component_el_button, {\n        loading: $data.loadingbut,\n        icon: \"el-icon-check\",\n        type: \"primary\",\n        size: \"small\",\n        onClick: $options.takePhoneUpfile,\n        style: {\n          \"margin-top\": \"10px\"\n        }\n      }, {\n        default: _withCtx(() => [_hoisted_8]),\n        _: 1\n        /* STABLE */\n\n      }, 8\n      /* PROPS */\n      , [\"loading\", \"onClick\"])]),\n      _: 1\n      /* STABLE */\n\n    })]),\n    _: 1\n    /* STABLE */\n\n  })]);\n}","map":{"version":3,"mappings":";;EAcOA,KAAK,EAAC;EAAaC,KAAoB,EAApB;IAAA;EAAA;;;gCAGlBC,oBASM,KATN,EASM;EARJD,KAKC,EALD;IAAA;IAAA;IAAA;IAAA;EAAA;AAQI,CATN,EAOC,OAPD,EASA;AAAA;AATA;;gCAWAC,oBAAmD,OAAnD,EAAmD;EAA5CC,EAAE,EAAC,OAAyC;EAAjCC,KAAK,EAAC,KAA2B;EAArBC,MAAM,EAAC;AAAc,CAAnD;;AAAA;;;EACKL,KAAK,EAAC;;;iDAON;;gCAKLE,oBASM,KATN,EASM;EARJD,KAKC,EALD;IAAA;IAAA;IAAA;IAAA;EAAA;AAQI,CATN,EAOC,QAPD,EASA;AAAA;AATA;;gCAWAC,oBAKU,QALV,EAKU;EAJRC,EAAE,EAAC,QAIK;EAHRC,KAAK,EAAC,KAGE;EAFRC,MAAM,EAAC,KAEC;EADRJ,KAAsB,EAAtB;IAAA;EAAA;AACQ,CALV;;AAAA;;iDAaG;;;;;;;;;uBAnDTK,oBAuDM,KAvDN,cAuDM,CAtDJC,aAqDSC,iBArDT,EAqDS;IArDAC,MAAM,EAAE;EAqDR,CArDT,EAAmB;sBACjB,MAuBS,CAvBTF,aAuBSG,iBAvBT,EAuBS;MAvBAC,IAAI,EAAE;IAuBN,CAvBT,EAAiB;wBACf,MASM,CATNC,UASM,EACNC,qCADM,EAENC,UAFM,EAGNZ,oBASM,KATN,cASM,CARJK,aAOCQ,oBAPD,EAOC;QANCC,IAAI,EAAC,SAMN;QALCC,IAAI,EAAC,OAKN;QAJCC,IAAI,EAAC,gBAIN;QAHEC,OAAK,EAAEC,kBAGT;QAFCnB,KAAwB,EAAxB;UAAA;QAAA;MAED,CAPD;0BAMG,MAAE;;;;OANL;;MAAA,cAQI,CATN,CAHM,EAVS;;;;IAAA,CAAjB,CAuBS,EACTM,aA2BSG,iBA3BT,EA2BS;MA3BAC,IAAI,EAAE;IA2BN,CA3BT,EAAiB;wBACf,MASM,CATNU,UASM,EACNR,uCADM,EAENS,UAFM,EAQNf,aAQCQ,oBARD,EAQC;QAPEQ,OAAO,EAAEC,gBAOX;QANCN,IAAI,EAAC,eAMN;QALCF,IAAI,EAAC,SAKN;QAJCC,IAAI,EAAC,OAIN;QAHEE,OAAK,EAAEC,wBAGT;QAFCnB,KAAwB,EAAxB;UAAA;QAAA;MAED,CARD;0BAOG,MAAE;;;;OAPL;;MAAA,yBARM,EAVS;;;;IAAA,CAAjB,CADS,EAxBQ;;;;EAAA,CAAnB,CAsDI,CAvDN","names":["class","style","_createElementVNode","id","width","height","_createElementBlock","_createVNode","_component_el_row","gutter","_component_el_col","span","_hoisted_2","_createCommentVNode","_hoisted_3","_component_el_button","type","size","icon","onClick","$options","_hoisted_6","_hoisted_7","loading","$data"],"sourceRoot":"","sources":["/Users/zhanghaha/Documents/GitHub/nkucs2022-17/face-vue/src/views/HomeView.vue"],"sourcesContent":["<!--<template>-->\n<!--  <div class=\"home\">-->\n<!--    <el-button type=\"primary\">我是按钮</el-button>-->\n<!--  </div>-->\n<!--</template>-->\n\n<!--<script>-->\n<!--// @ is an alias to /src-->\n\n<!--export default {-->\n<!--  name: \"Home_view\",-->\n<!--};-->\n<!--</script>-->\n<template>\n  <div class=\"camera-box\" style=\"width: 900px\">\n    <el-row :gutter=\"20\">\n      <el-col :span=\"12\">\n        <div\n          style=\"\n            text-align: center;\n            font-size: 14px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          \"\n        >\n          摄像头\n        </div>\n        <!-- 这里就是摄像头显示的画面 -->\n        <video id=\"video\" width=\"400\" height=\"300\"></video>\n        <div class=\"iCenter\">\n          <el-button\n            type=\"primary\"\n            size=\"small\"\n            icon=\"el-icon-camera\"\n            @click=\"takePhone\"\n            style=\"margin-top: 10px\"\n            >拍照</el-button\n          >\n        </div>\n      </el-col>\n      <el-col :span=\"12\">\n        <div\n          style=\"\n            text-align: center;\n            font-size: 14px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          \"\n        >\n          拍摄效果\n        </div>\n        <!-- 这里是点击拍照显示的图片画面 -->\n        <canvas\n          id=\"canvas\"\n          width=\"400\"\n          height=\"300\"\n          style=\"display: block\"\n        ></canvas>\n        <el-button\n          :loading=\"loadingbut\"\n          icon=\"el-icon-check\"\n          type=\"primary\"\n          size=\"small\"\n          @click=\"takePhoneUpfile\"\n          style=\"margin-top: 10px\"\n          >保存</el-button\n        >\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { putFileAttach } from \"@/api/customer/animalinfo\";\nexport default {\n  props: {\n    tackPhoto: {\n      //父组件传过来的状态\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      loadingbut: false,\n      preViewVisible: false,\n      blobFile: null,\n      canvas: null,\n      video: null,\n      mediaStreamTrack: \"\",\n    };\n  },\n  watch: {\n    tackPhoto: {\n      immediate: true,\n      handler(newVal) {\n        //监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n        if (newVal) {\n          var video = document.querySelector(\"video\");\n          var text = document.getElementById(\"text\");\n          // var mediaStreamTrack;\n\n          // 兼容代码\n          window.URL =\n            window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n          if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n          }\n          if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function (constraints) {\n              var getUserMedia =\n                navigator.webkitGetUserMedia ||\n                navigator.mozGetUserMedia ||\n                navigator.msGetUserMedia;\n              if (!getUserMedia) {\n                return Promise.reject(\n                  new Error(\"getUserMedia is not implemented in this browser\")\n                );\n              }\n              return new Promise(function (resolve, reject) {\n                getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            };\n          }\n\n          //摄像头调用配置\n          var mediaOpts = {\n            audio: false,\n            video: true,\n            video: { facingMode: \"environment\" }, // 或者 \"user\"\n            video: { width: 1280, height: 720 }\n            // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n          };\n\n          let that = this;\n          navigator.mediaDevices\n            .getUserMedia(mediaOpts)\n            .then(function (stream) {\n              that.mediaStreamTrack = stream;\n              video = document.querySelector(\"video\");\n              if (\"srcObject\" in video) {\n                video.srcObject = stream;\n              } else {\n                video.src =\n                  (window.URL && window.URL.createObjectURL(stream)) || stream;\n              }\n              video.play();\n            })\n            .catch(function (err) {\n              console.log(err);\n            });\n        }\n      },\n      deep: true,\n    },\n  },\n  mounted() {\n    // 摄像头\n    this.video = document.getElementById(\"video\");\n    //画布\n    this.canvas = document.getElementById(\"canvas\");\n  },\n  methods: {\n    takePhone() {\n      //点击拍照截图画面\n      let that = this;\n      that.canvas.getContext(\"2d\").drawImage(this.video, 0, 0, 400, 300);\n      let dataurl = that.canvas.toDataURL(\"image/jpeg\");\n      that.blobFile = that.dataURLtoFile(dataurl, \"camera.jpg\");\n      that.preViewVisible = true;\n    },\n    takePhoneUpfile() {\n      //保存图片\n      this.loadingbut = true;\n      let formData = new FormData();\n      formData.append(\"file\", this.blobFile); //图片内容\n      // 上传图片\n      putFileAttach(formData).then(\n        (res) => {\n          //后台接口\n          this.loadingbut = false;\n          this.$emit(\"picture\", res.data.data);\n          this.tackPhoto = false;\n          this.canvas.getContext(\"2d\").clearRect(0, 0, 400, 300); //清除画布\n          // 关闭摄像头\n          this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n            track.stop();\n          });\n        },\n        (error) => {\n          this.loadingbut = false;\n          window.console.log(error);\n        }\n      );\n    },\n  },\n};\n</script>\n\n<style>\n.camera-box #canvas {\n  border: 1px solid #dcdfe6;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}