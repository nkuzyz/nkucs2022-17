{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-9ea40744\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"camera_outer\"\n};\nconst _hoisted_2 = [\"width\", \"height\"];\nconst _hoisted_3 = [\"width\", \"height\"];\nconst _hoisted_4 = {\n  key: 0,\n  class: \"img_bg_camera\"\n};\nconst _hoisted_5 = [\"src\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"video\", {\n    id: \"videoCamera\",\n    width: $data.videoWidth,\n    height: $data.videoHeight,\n    autoplay: \"\"\n  }, null, 8\n  /* PROPS */\n  , _hoisted_2), _createElementVNode(\"canvas\", {\n    style: {\n      \"display\": \"none\"\n    },\n    id: \"canvasCamera\",\n    width: $data.videoWidth,\n    height: $data.videoHeight\n  }, null, 8\n  /* PROPS */\n  , _hoisted_3), $data.imgSrc ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"img\", {\n    src: $data.imgSrc,\n    alt: \"\",\n    class: \"tx_img\"\n  }, null, 8\n  /* PROPS */\n  , _hoisted_5)])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = $event => $options.getCompetence())\n  }, \"打开摄像头\"), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = $event => $options.stopNavigator())\n  }, \"关闭摄像头\"), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = $event => $options.setImage())\n  }, \"拍照\")]);\n}","map":{"version":3,"mappings":";;;;;EAeOA,KAAK,EAAC;;;;;;EAcUA,KAAK,EAAC;;;;uBAd3BC,oBAoBM,KApBN,cAoBM,CAnBJC,oBAKS,OALT,EAKS;IAJPC,EAAE,EAAC,aAII;IAHNC,KAAK,EAAEC,gBAGD;IAFNC,MAAM,EAAED,iBAEF;IADPE,QAAQ,EAAR;EACO,CALT;;EAAA,aAmBI,EAbJL,oBAKU,QALV,EAKU;IAJRM,KAAqB,EAArB;MAAA;IAAA,CAIQ;IAHRL,EAAE,EAAC,cAGK;IAFPC,KAAK,EAAEC,gBAEA;IADPC,MAAM,EAAED;EACD,CALV;;EAAA,aAaI,EANOA,8BAAXJ,oBAEM,KAFN,cAEM,CADJC,oBAA2C,KAA3C,EAA2C;IAArCO,GAAG,EAAEJ,YAAgC;IAAxBK,GAAG,EAAC,EAAoB;IAAjBV,KAAK,EAAC;EAAW,CAA3C;;EAAA,aACI,CAFN,sCAMI,EAHJE,oBAA+C,QAA/C,EAA+C;IAAtCS,OAAK,sCAAEC,wBAAF;EAAiC,CAA/C,EAAiC,OAAjC,CAGI,EAFJV,oBAA+C,QAA/C,EAA+C;IAAtCS,OAAK,sCAAEC,wBAAF;EAAiC,CAA/C,EAAiC,OAAjC,CAEI,EADJV,oBAAuC,QAAvC,EAAuC;IAA9BS,OAAK,sCAAEC,mBAAF;EAAyB,CAAvC,EAA4B,IAA5B,CACI,CApBN","names":["class","_createElementBlock","_createElementVNode","id","width","$data","height","autoplay","style","src","alt","onClick","$options"],"sourceRoot":"","sources":["/Users/zhanghaha/Documents/GitHub/nkucs2022-17/face-vue/src/views/HomeView.vue"],"sourcesContent":["<!--<template>-->\n<!--  <div class=\"home\">-->\n<!--    <el-button type=\"primary\">我是按钮</el-button>-->\n<!--  </div>-->\n<!--</template>-->\n\n<!--<script>-->\n<!--// @ is an alias to /src-->\n\n<!--export default {-->\n<!--  name: \"Home_view\",-->\n<!--};-->\n<!--</script>-->\n\n<template>\n  <div class=\"camera_outer\">\n    <video\n      id=\"videoCamera\"\n      :width=\"videoWidth\"\n      :height=\"videoHeight\"\n      autoplay\n    ></video>\n    <canvas\n      style=\"display: none\"\n      id=\"canvasCamera\"\n      :width=\"videoWidth\"\n      :height=\"videoHeight\"\n    ></canvas>\n\n    <div v-if=\"imgSrc\" class=\"img_bg_camera\">\n      <img :src=\"imgSrc\" alt=\"\" class=\"tx_img\" />\n    </div>\n    <button @click=\"getCompetence()\">打开摄像头</button>\n    <button @click=\"stopNavigator()\">关闭摄像头</button>\n    <button @click=\"setImage()\">拍照</button>\n  </div>\n</template>\n<script>\nexport default {\n  data() {\n    return {\n      videoWidth: 3000,\n      videoHeight: 300,\n      imgSrc: \"\",\n      thisCancas: null,\n      thisContext: null,\n      thisVideo: null,\n    };\n  },\n  methods: {\n    // 调用权限（打开摄像头功能）\n    getCompetence() {\n      var _this = this;\n      this.thisCancas = document.getElementById(\"canvasCamera\");\n      this.thisContext = this.thisCancas.getContext(\"2d\");\n      this.thisVideo = document.getElementById(\"videoCamera\");\n      // 旧版本浏览器可能根本不支持mediaDevices，我们首先设置一个空对象\n      if (navigator.mediaDevices === undefined) {\n        navigator.mediaDevices = {};\n      }\n      // 一些浏览器实现了部分mediaDevices，我们不能只分配一个对象\n      // 使用getUserMedia，因为它会覆盖现有的属性。\n      // 这里，如果缺少getUserMedia属性，就添加它。\n      if (navigator.mediaDevices.getUserMedia === undefined) {\n        navigator.mediaDevices.getUserMedia = function (constraints) {\n          // 首先获取现存的getUserMedia(如果存在)\n          var getUserMedia =\n            navigator.webkitGetUserMedia ||\n            navigator.mozGetUserMedia ||\n            navigator.getUserMedia;\n          // 有些浏览器不支持，会返回错误信息\n          // 保持接口一致\n          if (!getUserMedia) {\n            return Promise.reject(\n              new Error(\"getUserMedia is not implemented in this browser\")\n            );\n          }\n          // 否则，使用Promise将调用包装到旧的navigator.getUserMedia\n          return new Promise(function (resolve, reject) {\n            getUserMedia.call(navigator, constraints, resolve, reject);\n          });\n        };\n      }\n      var constraints = {\n        audio: false,\n        video: {\n          width: this.videoWidth,\n          height: this.videoHeight,\n          transform: \"scaleX(-1)\",\n        },\n      };\n      navigator.mediaDevices\n        .getUserMedia(constraints)\n        .then(function (stream) {\n          // 旧的浏览器可能没有srcObject\n          if (\"srcObject\" in _this.thisVideo) {\n            _this.thisVideo.srcObject = stream;\n          } else {\n            // 避免在新的浏览器中使用它，因为它正在被弃用。\n            _this.thisVideo.src = window.URL.createObjectURL(stream);\n          }\n          _this.thisVideo.onloadedmetadata = function (e) {\n            _this.thisVideo.play();\n          };\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n    //  绘制图片（拍照功能）\n\n    setImage() {\n      var _this = this;\n      // 点击，canvas画图\n      _this.thisContext.drawImage(\n        _this.thisVideo,\n        0,\n        0,\n        _this.videoWidth,\n        _this.videoHeight\n      );\n      // 获取图片base64链接\n      var image = this.thisCancas.toDataURL(\"image/png\");\n      _this.imgSrc = image;\n      this.$emit(\"refreshDataList\", this.imgSrc);\n    },\n    // base64转文件\n\n    dataURLtoFile(dataurl, filename) {\n      var arr = dataurl.split(\",\");\n      var mime = arr[0].match(/:(.*?);/)[1];\n      var bstr = atob(arr[1]);\n      var n = bstr.length;\n      var u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new File([u8arr], filename, { type: mime });\n    },\n    // 关闭摄像头\n\n    stopNavigator() {\n      this.thisVideo.srcObject.getTracks()[0].stop();\n    },\n  },\n};\n</script>\n<style lang=\"less\" scoped>\n.camera_outer {\n  position: relative;\n  overflow: hidden;\n  background: url(\"../../assets/img/user_0608_04.png\") no-repeat center;\n  background-size: 100%;\n  video,\n  canvas,\n  .tx_img {\n    -moz-transform: scaleX(-1);\n    -webkit-transform: scaleX(-1);\n    -o-transform: scaleX(-1);\n    transform: scaleX(-1);\n  }\n  .btn_camera {\n    position: absolute;\n    bottom: 4px;\n    left: 0;\n    right: 0;\n    height: 50px;\n    background-color: rgba(0, 0, 0, 0.3);\n    line-height: 50px;\n    text-align: center;\n    color: #ffffff;\n  }\n  .bg_r_img {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    top: 0;\n  }\n  .img_bg_camera {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    top: 0;\n    img {\n      width: 100%;\n      height: 100%;\n    }\n    .img_btn_camera {\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      height: 50px;\n      line-height: 50px;\n      text-align: center;\n      background-color: rgba(0, 0, 0, 0.3);\n      color: #ffffff;\n      .loding_img {\n        width: 50px;\n        height: 50px;\n      }\n    }\n  }\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}