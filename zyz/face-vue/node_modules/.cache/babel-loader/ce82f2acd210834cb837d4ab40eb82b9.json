{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { putFileAttach } from \"@/api/customer/animalinfo\";\nexport default {\n  props: {\n    tackPhoto: {\n      //父组件传过来的状态\n      type: Boolean,\n      default: false\n    }\n  },\n\n  data() {\n    return {\n      loadingbut: false,\n      preViewVisible: false,\n      blobFile: null,\n      canvas: null,\n      video: null,\n      mediaStreamTrack: \"\"\n    };\n  },\n\n  watch: {\n    tackPhoto: {\n      immediate: true,\n\n      handler(newVal) {\n        //监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n        if (newVal) {\n          var video = document.querySelector(\"video\");\n          var text = document.getElementById(\"text\"); // var mediaStreamTrack;\n          // 兼容代码\n\n          window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n          if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n          }\n\n          if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function (constraints) {\n              var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n              if (!getUserMedia) {\n                return Promise.reject(new Error(\"getUserMedia is not implemented in this browser\"));\n              }\n\n              return new Promise(function (resolve, reject) {\n                getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            };\n          } //摄像头调用配置\n\n\n          var mediaOpts = {\n            audio: false,\n            video: true,\n            video: {\n              facingMode: \"environment\"\n            },\n            // 或者 \"user\"\n            video: {\n              width: 1280,\n              height: 720\n            } // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n\n          };\n          let that = this;\n          navigator.mediaDevices.getUserMedia(mediaOpts).then(function (stream) {\n            that.mediaStreamTrack = stream;\n            video = document.querySelector(\"video\");\n\n            if (\"srcObject\" in video) {\n              video.srcObject = stream;\n            } else {\n              video.src = window.URL && window.URL.createObjectURL(stream) || stream;\n            }\n\n            video.play();\n          }).catch(function (err) {\n            console.log(err);\n          });\n        }\n      },\n\n      deep: true\n    }\n  },\n\n  mounted() {\n    // 摄像头\n    this.video = document.getElementById(\"video\"); //画布\n\n    this.canvas = document.getElementById(\"canvas\");\n  },\n\n  methods: {\n    takePhone() {\n      //点击拍照截图画面\n      let that = this;\n      that.canvas.getContext(\"2d\").drawImage(this.video, 0, 0, 400, 300);\n      let dataurl = that.canvas.toDataURL(\"image/jpeg\");\n      that.blobFile = that.dataURLtoFile(dataurl, \"camera.jpg\");\n      that.preViewVisible = true;\n    },\n\n    takePhoneUpfile() {\n      //保存图片\n      this.loadingbut = true;\n      let formData = new FormData();\n      formData.append(\"file\", this.blobFile); //图片内容\n      // 上传图片\n\n      putFileAttach(formData).then(res => {\n        //后台接口\n        this.loadingbut = false;\n        this.$emit(\"picture\", res.data.data);\n        this.tackPhoto = false;\n        this.canvas.getContext(\"2d\").clearRect(0, 0, 400, 300); //清除画布\n        // 关闭摄像头\n\n        this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n          track.stop();\n        });\n      }, error => {\n        this.loadingbut = false;\n        window.console.log(error);\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["putFileAttach","props","tackPhoto","type","Boolean","default","data","loadingbut","preViewVisible","blobFile","canvas","video","mediaStreamTrack","watch","immediate","handler","newVal","document","querySelector","text","getElementById","window","URL","webkitURL","mozURL","msURL","navigator","mediaDevices","undefined","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","Promise","reject","Error","resolve","call","mediaOpts","audio","facingMode","width","height","that","then","stream","srcObject","src","createObjectURL","play","catch","err","console","log","deep","mounted","methods","takePhone","getContext","drawImage","dataurl","toDataURL","dataURLtoFile","takePhoneUpfile","formData","FormData","append","res","$emit","clearRect","getVideoTracks","forEach","track","stop","error"],"sourceRoot":"","sources":["/Users/zhanghaha/Documents/GitHub/nkucs2022-17/face-vue/src/views/HomeView.vue"],"sourcesContent":["<!--<template>-->\n<!--  <div class=\"home\">-->\n<!--    <el-button type=\"primary\">我是按钮</el-button>-->\n<!--  </div>-->\n<!--</template>-->\n\n<!--<script>-->\n<!--// @ is an alias to /src-->\n\n<!--export default {-->\n<!--  name: \"Home_view\",-->\n<!--};-->\n<!--</script>-->\n<template>\n  <div class=\"camera-box\" style=\"width: 900px\">\n    <el-row :gutter=\"20\">\n      <el-col :span=\"12\">\n        <div\n          style=\"\n            text-align: center;\n            font-size: 14px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          \"\n        >\n          摄像头\n        </div>\n        <!-- 这里就是摄像头显示的画面 -->\n        <video id=\"video\" width=\"400\" height=\"300\"></video>\n        <div class=\"iCenter\">\n          <el-button\n            type=\"primary\"\n            size=\"small\"\n            icon=\"el-icon-camera\"\n            @click=\"takePhone\"\n            style=\"margin-top: 10px\"\n            >拍照</el-button\n          >\n        </div>\n      </el-col>\n      <el-col :span=\"12\">\n        <div\n          style=\"\n            text-align: center;\n            font-size: 14px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          \"\n        >\n          拍摄效果\n        </div>\n        <!-- 这里是点击拍照显示的图片画面 -->\n        <canvas\n          id=\"canvas\"\n          width=\"400\"\n          height=\"300\"\n          style=\"display: block\"\n        ></canvas>\n        <el-button\n          :loading=\"loadingbut\"\n          icon=\"el-icon-check\"\n          type=\"primary\"\n          size=\"small\"\n          @click=\"takePhoneUpfile\"\n          style=\"margin-top: 10px\"\n          >保存</el-button\n        >\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { putFileAttach } from \"@/api/customer/animalinfo\";\nexport default {\n  props: {\n    tackPhoto: {\n      //父组件传过来的状态\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      loadingbut: false,\n      preViewVisible: false,\n      blobFile: null,\n      canvas: null,\n      video: null,\n      mediaStreamTrack: \"\",\n    };\n  },\n  watch: {\n    tackPhoto: {\n      immediate: true,\n      handler(newVal) {\n        //监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n        if (newVal) {\n          var video = document.querySelector(\"video\");\n          var text = document.getElementById(\"text\");\n          // var mediaStreamTrack;\n\n          // 兼容代码\n          window.URL =\n            window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n          if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n          }\n          if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function (constraints) {\n              var getUserMedia =\n                navigator.webkitGetUserMedia ||\n                navigator.mozGetUserMedia ||\n                navigator.msGetUserMedia;\n              if (!getUserMedia) {\n                return Promise.reject(\n                  new Error(\"getUserMedia is not implemented in this browser\")\n                );\n              }\n              return new Promise(function (resolve, reject) {\n                getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            };\n          }\n\n          //摄像头调用配置\n          var mediaOpts = {\n            audio: false,\n            video: true,\n            video: { facingMode: \"environment\" }, // 或者 \"user\"\n            video: { width: 1280, height: 720 }\n            // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n          };\n\n          let that = this;\n          navigator.mediaDevices\n            .getUserMedia(mediaOpts)\n            .then(function (stream) {\n              that.mediaStreamTrack = stream;\n              video = document.querySelector(\"video\");\n              if (\"srcObject\" in video) {\n                video.srcObject = stream;\n              } else {\n                video.src =\n                  (window.URL && window.URL.createObjectURL(stream)) || stream;\n              }\n              video.play();\n            })\n            .catch(function (err) {\n              console.log(err);\n            });\n        }\n      },\n      deep: true,\n    },\n  },\n  mounted() {\n    // 摄像头\n    this.video = document.getElementById(\"video\");\n    //画布\n    this.canvas = document.getElementById(\"canvas\");\n  },\n  methods: {\n    takePhone() {\n      //点击拍照截图画面\n      let that = this;\n      that.canvas.getContext(\"2d\").drawImage(this.video, 0, 0, 400, 300);\n      let dataurl = that.canvas.toDataURL(\"image/jpeg\");\n      that.blobFile = that.dataURLtoFile(dataurl, \"camera.jpg\");\n      that.preViewVisible = true;\n    },\n    takePhoneUpfile() {\n      //保存图片\n      this.loadingbut = true;\n      let formData = new FormData();\n      formData.append(\"file\", this.blobFile); //图片内容\n      // 上传图片\n      putFileAttach(formData).then(\n        (res) => {\n          //后台接口\n          this.loadingbut = false;\n          this.$emit(\"picture\", res.data.data);\n          this.tackPhoto = false;\n          this.canvas.getContext(\"2d\").clearRect(0, 0, 400, 300); //清除画布\n          // 关闭摄像头\n          this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n            track.stop();\n          });\n        },\n        (error) => {\n          this.loadingbut = false;\n          window.console.log(error);\n        }\n      );\n    },\n  },\n};\n</script>\n\n<style>\n.camera-box #canvas {\n  border: 1px solid #dcdfe6;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}