{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { putFileAttach } from \"@/api/customer/animalinfo\";\nexport default {\n  props: {\n    tackPhoto: {\n      //父组件传过来的状态\n      type: Boolean,\n      default: false\n    }\n  },\n\n  data() {\n    return {\n      loadingbut: false,\n      preViewVisible: false,\n      blobFile: null,\n      canvas: null,\n      video: null,\n      mediaStreamTrack: ''\n    };\n  },\n\n  watch: {\n    tackPhoto: {\n      immediate: true,\n\n      handler(newVal) {\n        //监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n        if (newVal) {\n          var video = document.querySelector('video');\n          var text = document.getElementById('text'); // var mediaStreamTrack;\n          // 兼容代码\n\n          window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n          if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n          }\n\n          if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function (constraints) {\n              var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n              if (!getUserMedia) {\n                return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n              }\n\n              return new Promise(function (resolve, reject) {\n                getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            };\n          } //摄像头调用配置\n\n\n          var mediaOpts = {\n            audio: false,\n            video: true,\n            video: {\n              facingMode: \"environment\"\n            } // 或者 \"user\"\n            // video: { width: 1280, height: 720 }\n            // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n\n          };\n          let that = this;\n          navigator.mediaDevices.getUserMedia(mediaOpts).then(function (stream) {\n            that.mediaStreamTrack = stream;\n            video = document.querySelector('video');\n\n            if (\"srcObject\" in video) {\n              video.srcObject = stream;\n            } else {\n              video.src = window.URL && window.URL.createObjectURL(stream) || stream;\n            }\n\n            video.play();\n          }).catch(function (err) {\n            console.log(err);\n          });\n        }\n      },\n\n      deep: true\n    }\n  },\n\n  mounted() {\n    // 摄像头\n    this.video = document.getElementById('video'); //画布\n\n    this.canvas = document.getElementById('canvas');\n  },\n\n  methods: {\n    takePhone() {\n      //点击拍照截图画面\n      let that = this;\n      that.canvas.getContext('2d').drawImage(this.video, 0, 0, 400, 300);\n      let dataurl = that.canvas.toDataURL('image/jpeg');\n      that.blobFile = that.dataURLtoFile(dataurl, 'camera.jpg');\n      that.preViewVisible = true;\n    },\n\n    takePhoneUpfile() {\n      //保存图片\n      this.loadingbut = true;\n      let formData = new FormData();\n      formData.append('file', this.blobFile); //图片内容\n      // 上传图片\n\n      putFileAttach(formData).then(res => {\n        //后台接口\n        this.loadingbut = false;\n        this.$emit('picture', res.data.data);\n        this.tackPhoto = false;\n        this.canvas.getContext('2d').clearRect(0, 0, 400, 300); //清除画布\n        // 关闭摄像头\n\n        this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n          track.stop();\n        });\n      }, error => {\n        this.loadingbut = false;\n        window.console.log(error);\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["putFileAttach","props","tackPhoto","type","Boolean","default","data","loadingbut","preViewVisible","blobFile","canvas","video","mediaStreamTrack","watch","immediate","handler","newVal","document","querySelector","text","getElementById","window","URL","webkitURL","mozURL","msURL","navigator","mediaDevices","undefined","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","Promise","reject","Error","resolve","call","mediaOpts","audio","facingMode","that","then","stream","srcObject","src","createObjectURL","play","catch","err","console","log","deep","mounted","methods","takePhone","getContext","drawImage","dataurl","toDataURL","dataURLtoFile","takePhoneUpfile","formData","FormData","append","res","$emit","clearRect","getVideoTracks","forEach","track","stop","error"],"sourceRoot":"","sources":["/Users/zhanghaha/Documents/GitHub/nkucs2022-17/face-vue/src/views/HomeView.vue"],"sourcesContent":["<!--<template>-->\n<!--  <div class=\"home\">-->\n<!--    <el-button type=\"primary\">我是按钮</el-button>-->\n<!--  </div>-->\n<!--</template>-->\n\n<!--<script>-->\n<!--// @ is an alias to /src-->\n\n<!--export default {-->\n<!--  name: \"Home_view\",-->\n<!--};-->\n<!--</script>-->\n<template>\n  <div class=\"camera-box\" style=\"width: 900px;\">\n    <el-row :gutter=\"20\">\n      <el-col :span=\"12\">\n        <div style=\"text-align: center;font-size: 14px;font-weight: bold;margin-bottom: 10px;\">摄像头</div>\n        <!-- 这里就是摄像头显示的画面 -->\n        <video id=\"video\" width=\"400\" height=\"300\"></video>\n        <div class=\"iCenter\" >\n          <el-button type='primary' size='small' icon=\"el-icon-camera\" @click=\"takePhone\" style=\"margin-top: 10px;\">拍照</el-button>\n        </div>\n      </el-col>\n      <el-col :span=\"12\">\n        <div style=\"text-align: center;font-size: 14px;font-weight: bold;margin-bottom: 10px;\">拍摄效果</div>\n        <!-- 这里是点击拍照显示的图片画面 -->\n        <canvas id='canvas' width='400' height='300' style=\"display: block;\"></canvas>\n        <el-button :loading=\"loadingbut\" icon=\"el-icon-check\" type='primary' size='small' @click=\"takePhoneUpfile\" style=\"margin-top: 10px;\">保存</el-button>\n      </el-col>\n    </el-row>\n</div>\n</template>\n<script>\n  import {putFileAttach} from \"@/api/customer/animalinfo\";\n  export default {\n    props:{\n      tackPhoto:{//父组件传过来的状态\n        type:Boolean,\n        default:false\n      }\n    },\n    data() {\n      return {\n        loadingbut:false,\n        preViewVisible: false,\n        blobFile: null,\n        canvas: null,\n        video: null,\n        mediaStreamTrack: '',\n      }\n    },\n    watch:{\n      tackPhoto:{\n        immediate: true,\n        handler (newVal) {//监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n\t        if (newVal) {\n            var video = document.querySelector('video');\n            var text = document.getElementById('text');\n            // var mediaStreamTrack;\n\n            // 兼容代码\n            window.URL = (window.URL || window.webkitURL || window.mozURL || window.msURL);\n\n            if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n            }\n            if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function(constraints) {\n              var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n              if (!getUserMedia) {\n              return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n              }\n              return new Promise(function(resolve, reject) {\n              getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            }\n            }\n\n            //摄像头调用配置\n            var mediaOpts = {\n            audio: false,\n            video: true,\n            video: { facingMode: \"environment\"} // 或者 \"user\"\n            // video: { width: 1280, height: 720 }\n            // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n            }\n\n            let that=this;\n            navigator.mediaDevices.getUserMedia(mediaOpts).then(function(stream) {\n            that.mediaStreamTrack = stream;\n            video = document.querySelector('video');\n            if (\"srcObject\" in video) {\n              video.srcObject = stream\n            } else {\n              video.src = window.URL && window.URL.createObjectURL(stream) || stream\n            }\n            video.play();\n            }).catch(function (err) {\n              console.log(err)\n            });\n\n\t      \t}\n\t      },\n        deep:true\n      },\n    },\n    mounted() {\n      // 摄像头\n      this.video = document.getElementById('video');\n      //画布\n      this.canvas = document.getElementById('canvas')\n\n    },\n    methods: {\n      takePhone() {//点击拍照截图画面\n        let that = this;\n        that.canvas.getContext('2d').drawImage(this.video, 0, 0, 400, 300) ;\n        let dataurl = that.canvas.toDataURL('image/jpeg')\n        that.blobFile = that.dataURLtoFile(dataurl, 'camera.jpg');\n        that.preViewVisible = true\n      },\n      takePhoneUpfile() {//保存图片\n        this.loadingbut=true;\n        let formData = new FormData()\n        formData.append('file', this.blobFile);//图片内容\n        // 上传图片\n        putFileAttach(formData).then(res=>{//后台接口\n          this.loadingbut=false;\n          this.$emit('picture',res.data.data);\n          this.tackPhoto=false;\n          this.canvas.getContext('2d').clearRect(0, 0, 400, 300);//清除画布\n          // 关闭摄像头\n          this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n            track.stop();\n           });\n        },error=>{\n          this.loadingbut=false;\n          window.console.log(error);\n        });\n      },\n    }\n  }\n</script>\n<style>\n .camera-box #canvas{\n  border: 1px solid #DCDFE6;\n  }\n</style>\n\n"]},"metadata":{},"sourceType":"module"}