{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"camera-box\",\n  style: {\n    \"width\": \"900px\"\n  }\n};\n\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"div\", {\n  style: {\n    \"text-align\": \"center\",\n    \"font-size\": \"14px\",\n    \"font-weight\": \"bold\",\n    \"margin-bottom\": \"10px\"\n  }\n}, \"摄像头\", -1\n/* HOISTED */\n);\n\nconst _hoisted_3 = /*#__PURE__*/_createElementVNode(\"video\", {\n  id: \"video\",\n  width: \"400\",\n  height: \"300\"\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_4 = {\n  class: \"iCenter\"\n};\n\nconst _hoisted_5 = /*#__PURE__*/_createTextVNode(\"拍照\");\n\nconst _hoisted_6 = /*#__PURE__*/_createElementVNode(\"div\", {\n  style: {\n    \"text-align\": \"center\",\n    \"font-size\": \"14px\",\n    \"font-weight\": \"bold\",\n    \"margin-bottom\": \"10px\"\n  }\n}, \"拍摄效果\", -1\n/* HOISTED */\n);\n\nconst _hoisted_7 = /*#__PURE__*/_createElementVNode(\"canvas\", {\n  id: \"canvas\",\n  width: \"400\",\n  height: \"300\",\n  style: {\n    \"display\": \"block\"\n  }\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_8 = /*#__PURE__*/_createTextVNode(\"保存\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n\n  const _component_el_col = _resolveComponent(\"el-col\");\n\n  const _component_el_row = _resolveComponent(\"el-row\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_row, {\n    gutter: 20\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_col, {\n      span: 12\n    }, {\n      default: _withCtx(() => [_hoisted_2, _createCommentVNode(\" 这里就是摄像头显示的画面 \"), _hoisted_3, _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n        type: \"primary\",\n        size: \"small\",\n        icon: \"el-icon-camera\",\n        onClick: $options.takePhone,\n        style: {\n          \"margin-top\": \"10px\"\n        }\n      }, {\n        default: _withCtx(() => [_hoisted_5]),\n        _: 1\n        /* STABLE */\n\n      }, 8\n      /* PROPS */\n      , [\"onClick\"])])]),\n      _: 1\n      /* STABLE */\n\n    }), _createVNode(_component_el_col, {\n      span: 12\n    }, {\n      default: _withCtx(() => [_hoisted_6, _createCommentVNode(\" 这里是点击拍照显示的图片画面 \"), _hoisted_7, _createVNode(_component_el_button, {\n        loading: $data.loadingbut,\n        icon: \"el-icon-check\",\n        type: \"primary\",\n        size: \"small\",\n        onClick: $options.takePhoneUpfile,\n        style: {\n          \"margin-top\": \"10px\"\n        }\n      }, {\n        default: _withCtx(() => [_hoisted_8]),\n        _: 1\n        /* STABLE */\n\n      }, 8\n      /* PROPS */\n      , [\"loading\", \"onClick\"])]),\n      _: 1\n      /* STABLE */\n\n    })]),\n    _: 1\n    /* STABLE */\n\n  })]);\n}","map":{"version":3,"mappings":";;EAcOA,KAAK,EAAC;EAAaC,KAAqB,EAArB;IAAA;EAAA;;;gCAGlBC,oBAAgG,KAAhG,EAAgG;EAA3FD,KAAiF,EAAjF;IAAA;IAAA;IAAA;IAAA;EAAA;AAA2F,CAAhG,EAAuF,KAAvF,EAA0F;AAAA;AAA1F;;gCAEAC,oBAAmD,OAAnD,EAAmD;EAA5CC,EAAE,EAAC,OAAyC;EAAjCC,KAAK,EAAC,KAA2B;EAArBC,MAAM,EAAC;AAAc,CAAnD;;AAAA;;;EACKL,KAAK,EAAC;;;iDACiG;;gCAI5GE,oBAAiG,KAAjG,EAAiG;EAA5FD,KAAiF,EAAjF;IAAA;IAAA;IAAA;IAAA;EAAA;AAA4F,CAAjG,EAAuF,MAAvF,EAA2F;AAAA;AAA3F;;gCAEAC,oBAA8E,QAA9E,EAA8E;EAAtEC,EAAE,EAAC,QAAmE;EAA1DC,KAAK,EAAC,KAAoD;EAA9CC,MAAM,EAAC,KAAuC;EAAjCJ,KAAuB,EAAvB;IAAA;EAAA;AAAiC,CAA9E;;AAAA;;iDACqI;;;;;;;;;uBAd3IK,oBAiBI,KAjBJ,cAiBI,CAhBFC,aAeSC,iBAfT,EAeS;IAfAC,MAAM,EAAE;EAeR,CAfT,EAAmB;sBACjB,MAOS,CAPTF,aAOSG,iBAPT,EAOS;MAPAC,IAAI,EAAE;IAON,CAPT,EAAiB;wBACf,MAAgG,CAAhGC,UAAgG,EAChGC,qCADgG,EAEhGC,UAFgG,EAGhGZ,oBAEM,KAFN,cAEM,CADJK,aAAwHQ,oBAAxH,EAAwH;QAA7GC,IAAI,EAAC,SAAwG;QAA9FC,IAAI,EAAC,OAAyF;QAAjFC,IAAI,EAAC,gBAA4E;QAA1DC,OAAK,EAAEC,kBAAmD;QAAxCnB,KAAyB,EAAzB;UAAA;QAAA;MAAwC,CAAxH;0BAA0G,MAAE;;;;OAA5G;;MAAA,cACI,CAFN,CAHgG,EADjF;;;;IAAA,CAAjB,CAOS,EACTM,aAKSG,iBALT,EAKS;MALAC,IAAI,EAAE;IAKN,CALT,EAAiB;wBACf,MAAiG,CAAjGU,UAAiG,EACjGR,uCADiG,EAEjGS,UAFiG,EAGjGf,aAAmJQ,oBAAnJ,EAAmJ;QAAvIQ,OAAO,EAAEC,gBAA8H;QAAlHN,IAAI,EAAC,eAA6G;QAA7FF,IAAI,EAAC,SAAwF;QAA9EC,IAAI,EAAC,OAAyE;QAAhEE,OAAK,EAAEC,wBAAyD;QAAxCnB,KAAyB,EAAzB;UAAA;QAAA;MAAwC,CAAnJ;0BAAqI,MAAE;;;;OAAvI;;MAAA,yBAHiG,EADlF;;;;IAAA,CAAjB,CADS,EARQ;;;;EAAA,CAAnB,CAgBE,CAjBJ","names":["class","style","_createElementVNode","id","width","height","_createElementBlock","_createVNode","_component_el_row","gutter","_component_el_col","span","_hoisted_2","_createCommentVNode","_hoisted_3","_component_el_button","type","size","icon","onClick","$options","_hoisted_6","_hoisted_7","loading","$data"],"sourceRoot":"","sources":["/Users/zhanghaha/Documents/GitHub/nkucs2022-17/face-vue/src/views/HomeView.vue"],"sourcesContent":["<!--<template>-->\n<!--  <div class=\"home\">-->\n<!--    <el-button type=\"primary\">我是按钮</el-button>-->\n<!--  </div>-->\n<!--</template>-->\n\n<!--<script>-->\n<!--// @ is an alias to /src-->\n\n<!--export default {-->\n<!--  name: \"Home_view\",-->\n<!--};-->\n<!--</script>-->\n<template>\n  <div class=\"camera-box\" style=\"width: 900px;\">\n    <el-row :gutter=\"20\">\n      <el-col :span=\"12\">\n        <div style=\"text-align: center;font-size: 14px;font-weight: bold;margin-bottom: 10px;\">摄像头</div>\n        <!-- 这里就是摄像头显示的画面 -->\n        <video id=\"video\" width=\"400\" height=\"300\"></video>\n        <div class=\"iCenter\" >\n          <el-button type='primary' size='small' icon=\"el-icon-camera\" @click=\"takePhone\" style=\"margin-top: 10px;\">拍照</el-button>\n        </div>\n      </el-col>\n      <el-col :span=\"12\">\n        <div style=\"text-align: center;font-size: 14px;font-weight: bold;margin-bottom: 10px;\">拍摄效果</div>\n        <!-- 这里是点击拍照显示的图片画面 -->\n        <canvas id='canvas' width='400' height='300' style=\"display: block;\"></canvas>\n        <el-button :loading=\"loadingbut\" icon=\"el-icon-check\" type='primary' size='small' @click=\"takePhoneUpfile\" style=\"margin-top: 10px;\">保存</el-button>\n      </el-col>\n    </el-row>\n</div>\n</template>\n<script>\n  import {putFileAttach} from \"@/api/customer/animalinfo\";\n  export default {\n    props:{\n      tackPhoto:{//父组件传过来的状态\n        type:Boolean,\n        default:false\n      }\n    },\n    data() {\n      return {\n        loadingbut:false,\n        preViewVisible: false,\n        blobFile: null,\n        canvas: null,\n        video: null,\n        mediaStreamTrack: '',\n      }\n    },\n    watch:{\n      tackPhoto:{\n        immediate: true,\n        handler (newVal) {//监听接收到拍摄状态后，开始调取摄像头权限。如果功能是在一个组件里面，下面步骤可以直接写在自己的触发方法里面\n\t        if (newVal) {\n            var video = document.querySelector('video');\n            var text = document.getElementById('text');\n            // var mediaStreamTrack;\n\n            // 兼容代码\n            window.URL = (window.URL || window.webkitURL || window.mozURL || window.msURL);\n\n            if (navigator.mediaDevices === undefined) {\n            navigator.mediaDevices = {};\n            }\n            if (navigator.mediaDevices.getUserMedia === undefined) {\n            navigator.mediaDevices.getUserMedia = function(constraints) {\n              var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n              if (!getUserMedia) {\n              return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n              }\n              return new Promise(function(resolve, reject) {\n              getUserMedia.call(navigator, constraints, resolve, reject);\n              });\n            }\n            }\n\n            //摄像头调用配置\n            var mediaOpts = {\n            audio: false,\n            video: true,\n            video: { facingMode: \"environment\"} // 或者 \"user\"\n            // video: { width: 1280, height: 720 }\n            // video: { facingMode: { exact: \"environment\" } }// 或者 \"user\"\n            }\n\n            let that=this;\n            navigator.mediaDevices.getUserMedia(mediaOpts).then(function(stream) {\n            that.mediaStreamTrack = stream;\n            video = document.querySelector('video');\n            if (\"srcObject\" in video) {\n              video.srcObject = stream\n            } else {\n              video.src = window.URL && window.URL.createObjectURL(stream) || stream\n            }\n            video.play();\n            }).catch(function (err) {\n              console.log(err)\n            });\n\n\t      \t}\n\t      },\n        deep:true\n      },\n    },\n    mounted() {\n      // 摄像头\n      this.video = document.getElementById('video');\n      //画布\n      this.canvas = document.getElementById('canvas')\n\n    },\n    methods: {\n      takePhone() {//点击拍照截图画面\n        let that = this;\n        that.canvas.getContext('2d').drawImage(this.video, 0, 0, 400, 300) ;\n        let dataurl = that.canvas.toDataURL('image/jpeg')\n        that.blobFile = that.dataURLtoFile(dataurl, 'camera.jpg');\n        that.preViewVisible = true\n      },\n      takePhoneUpfile() {//保存图片\n        this.loadingbut=true;\n        let formData = new FormData()\n        formData.append('file', this.blobFile);//图片内容\n        // 上传图片\n        putFileAttach(formData).then(res=>{//后台接口\n          this.loadingbut=false;\n          this.$emit('picture',res.data.data);\n          this.tackPhoto=false;\n          this.canvas.getContext('2d').clearRect(0, 0, 400, 300);//清除画布\n          // 关闭摄像头\n          this.mediaStreamTrack.getVideoTracks().forEach(function (track) {\n            track.stop();\n           });\n        },error=>{\n          this.loadingbut=false;\n          window.console.log(error);\n        });\n      },\n    }\n  }\n</script>\n<style>\n .camera-box #canvas{\n  border: 1px solid #DCDFE6;\n  }\n</style>\n\n"]},"metadata":{},"sourceType":"module"}